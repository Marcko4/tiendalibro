<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TiendaLibro - Inicio</title>
  <link rel="icon" type="image/png" href="../images/LogoBookHub (1).png">
  <link rel="stylesheet" href="assets/css/index.css">
</head>
<body>
  <header style="position:relative;">
    <div style="display:flex;align-items:center;height:100%;"><img src="../images/LogoBookHub (1).png" alt="Logo BookHub" style="height:130px;object-fit:contain;"></div>
    <nav>
      <span id="user-info" style="display:none;margin-left:1em;"></span>
      <a href="index.html">Inicio</a>
      <a href="about.html">About</a>
      <a href="login.html" id="login-link">Login</a>
      <a href="register.html" id="register-link">Registro</a>
      <a href="carrito.html" id="carrito-link">Carrito</a>
      <button id="logout-btn" style="display:none;margin-left:1em;">Logout</button>
    </nav>
    <!-- Caja de herramientas desplegable derecha -->
    <div id="toolbox-toggle" style="display:none;position:fixed;top:25%;right:0;z-index:3000;">
      <button style="background:#6a89cc;color:#fff;border:none;padding:1em 1.2em 1em 1.5em;border-radius:18px 0 0 18px;font-size:1.2em;font-weight:700;box-shadow:0 2px 8px rgba(44,62,80,0.13);cursor:pointer;">☰ Herramientas</button>
    </div>
    <aside id="toolbox" style="display:none;position:fixed;top:25%;right:-260px;width:260px;background:linear-gradient(120deg,#6a89cc 70%,#2a3a5a 100%);box-shadow:0 2px 18px rgba(44,62,80,0.13);border-radius:18px 0 0 18px;z-index:3100;transition:right 0.3s;flex-direction:column;align-items:center;padding:2em 0;">
      <button id="close-toolbox" style="position:absolute;top:1.2em;left:1.2em;background:none;border:none;font-size:2em;color:#fff;cursor:pointer;">&times;</button>
      <a href="alquileres.html" style="color:#fff;font-size:1.13em;font-weight:600;margin:1.2em 0;text-decoration:none;padding:0.7em 2.2em;border-radius:14px;transition:background 0.2s;display:block;width:80%;text-align:center;">Vista de alquileres</a>
      <a href="libros.html" style="color:#fff;font-size:1.13em;font-weight:600;margin:1.2em 0;text-decoration:none;padding:0.7em 2.2em;border-radius:14px;transition:background 0.2s;display:block;width:80%;text-align:center;">Administrar Libros</a>
      <a href="informe.html" style="color:#fff;font-size:1.13em;font-weight:600;margin:1.2em 0;text-decoration:none;padding:0.7em 2.2em;border-radius:14px;transition:background 0.2s;display:block;width:80%;text-align:center;">Informe</a>
    </aside>
    <div id="burbuja-revision" style="display:none;position:absolute;z-index:4000;background:#e74c3c;color:#fff;padding:0.5em 1em;border-radius:12px;font-size:0.7em;font-weight:600;box-shadow:0 2px 8px rgba(231,76,60,0.13);transition:opacity 0.2s;min-width:120px;max-width:180px;text-align:center;">
      Algunos libros necesitan revisión
    </div>
  </header>
  <main>
    <section class="carousel-container">
      <div class="carousel" id="carousel">
        <!-- Libros destacados se insertarán aquí con JS -->
      </div>
    </section>
    <section class="destacados">
      <h2>Libros Disponibles</h2>
      <div id="libros-destacados"></div>
    </section>
    <section id="alquileres-vista" style="display:none;"></section>
  </main>
  <footer>
    <p>&copy; 2025 <span class="logo">BookHub</span></p>
  </footer>
  <script src="assets/js/index.js"></script>
  <script src="assets/js/userSession.js"></script>
  <script src="assets/js/alquileres.js"></script>
  <script>
      const toolbox = document.getElementById('toolbox');
      const toolboxToggle = document.getElementById('toolbox-toggle');
      const closeToolbox = document.getElementById('close-toolbox');
      const burbuja = document.getElementById('burbuja-revision');
      const logoutBtn = document.getElementById('logout-btn');
      toolboxToggle.onclick = function() {
        toolbox.style.right = '0';
      };
      closeToolbox.onclick = function() {
        toolbox.style.right = '-260px';
      };
      document.addEventListener('click', function(e) {
        if (toolbox.style.right === '0px' && !toolbox.contains(e.target) && e.target !== toolboxToggle && e.target !== toolboxToggle.firstElementChild) {
          toolbox.style.right = '-260px';
        }
      });
      // --- Burbuja de revisión de stock para empleados ---
      (function() {
        const rol = localStorage.getItem('rol');
        const username = localStorage.getItem('username');
        function posicionarBurbuja() {
          if (logoutBtn && burbuja && logoutBtn.offsetParent !== null) {
            const rect = logoutBtn.getBoundingClientRect();
            const headerRect = document.querySelector('header').getBoundingClientRect();
            burbuja.style.top = (rect.bottom - headerRect.top + 8) + 'px';
            burbuja.style.left = (rect.right - headerRect.left - burbuja.offsetWidth) + 'px';
          }
        }
        if (rol === 'empleado' && username) {
          fetch('http://localhost:3000/api/libros')
            .then(resp => resp.json())
            .then(libros => {
              const necesitaRevision = libros.some(l => (Number(l.stock_venta) < 3) || (Number(l.stock_alquiler) < 3));
              if (necesitaRevision) {
                burbuja.style.display = 'block';
                setTimeout(posicionarBurbuja, 100); // Espera a que se muestre
                window.addEventListener('resize', posicionarBurbuja);
              }
            });
        } else {
          // Si no es empleado o no hay usuario logueado, nunca mostrar la burbuja
          burbuja.style.display = 'none';
        }
      })();
    </script>
</body>
</html>
